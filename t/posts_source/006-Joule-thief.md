===
date: 2018-04-04
===
# Joule thief

Citing [Wikipedia](https://en.wikipedia.org/wiki/Joule_thief):
> A joule thief is a minimalist self-oscillating voltage booster that is small, low-cost, and easy to build,
> typically used for driving small loads. This circuit is also known by other names such as blocking oscillator,
> joule ringer, vampire torch.

The name comes from the fact that this circuit can work even on batery that
is almost totally depleted (0.7 V is enough).
The best description of working principle that I found is [here](http://madscientisthut.com/wordpress/daily-blog/joule-thief-simulation-ii/attachment/jtsim/).

It's so easy to build it that I did it just to see it live. Insted of typical
toroid 1:1 transformer I used transformer unsoldered from broken phone charger.

![joule thief](006-1.jpg)

Despite I used transformer with unknown parameters not typical for this circuit it worked correctly.
I was curious what frequency it generates with this transformer (Wikipedia states that
usually it's around 50 kHz). I tried conneting piezoelectric membrane to it and I couldn't hear
anything, so I concluded that frequency is greater than 20 kHz or my hearing is bad.

LED limits voltage generated by this ciruit, so it should be safe to connect it
as an input of microcontroller.

I wrote a simple program that uses external interrupt to count impulses. It turned out
that frequency is ~210 kHz. When I switch transformer windings it goes down to
27.9 kHz. I guess that's expected when it's not 1:1 transformer.

On the next day I enhanced program to record and print timings. Here are measured
times (in ms) for non-inverted windings:

```
1 1,75
0 2,98
1 1,72
0 3,00
...
1 1,73
0 3,00
```
And here are measured times for inverted windings:
```
1 9,68
0 26,19
1 9,69
0 26,19
...
1 9,68
0 26,19
```
The source code is as usually [on Github](https://github.com/tocisz/forthplay/blob/master/exti/exti2.fs).

*Question 1.*

How to use input capture on STM32? Any piece of advice?
